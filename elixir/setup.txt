docker run --name discourse-db -e POSTGRES_PASSWORD=postgres -v /docker/discourse/db:/var/lib/postgresql/data -p 5432:5432 --restart=always -d postgres

create table Users (
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	email text NOT NULL,
	username text NOT NULL
);

CREATE UNIQUE INDEX ON Users(email);
CREATE UNIQUE INDEX ON Users(username);

create table Timelines (
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	title text NOT NULL,
	author int references Users(id),
	created_at timestamptz default now(),
	published boolean DEFAULT FALSE
);

CREATE INDEX ON Timelines(author);

create table TimelineEntries (
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	timeline int references Timelines(id),
	timestamp timestamptz NOT NULL,
	title text NOT NULL,
	body text,
	sources text[],
	imgurl text,
	author int references Users(id) not null,
	upvotes int default 0,
	downvotes int default 0
);

CREATE INDEX ON TimelineEntries(timeline);

CREATE TABLE auth_tokens (
	uid int references users(id) not null,
	username text not null references users(username),
	token char(12),
	expires timestamp
);
create index on auth_tokens(token);
create index on auth_tokens(username);